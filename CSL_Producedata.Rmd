---
title: "CSL_Producedata"
output: html_document
---


```{r setup, include = FALSE}
set.seed(4609948)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
library(knitr)
opts_chunk$set(echo = FALSE)
library("papaja")
library(dplyr)
library(tidyr)
library(ggplot2)
library(xtable)
library(afex)
library(emmeans)
```


```{r organiseBehavData}
#Load day 1 data
day1Behav <- read.table("Behaviour/CSL3D_Behav_Day1.csv",header = TRUE, sep=",")
#Remove eprme junk
day1Behav <- select(day1Behav, -c(Session,DataFile.Basename,AutoResponseWarning,Clock.Information,Display.RefreshRate,ExperimentVersion,RandomSeed,RuntimeCapabilities,RuntimeVersion,RuntimeVersionExpected,SessionDate,SessionStartDateTimeUtc,SessionTime,StudioVersion,TestMode,BlockAccC,BlockAccL,BlockRTC,BlockRTL,pos1,pos2,pos3,pos4,pos5,pos6,pos7,pos8,posColor,posShape,posSingDistr,posTarget,PracticeL,PracticeL.Cycle,PracticeL.Sample,PracticeLC,PracticeLC.Cycle,PracticeLC.Sample,CompSearch.OnsetToOnsetTime,LearnSearch.OnsetToOnsetTime,Response.OnsetToOnsetTime, Response2.OnsetToOnsetTime, Task, Task.Cycle, Task.Sample)
)
#Add session information and a count variable
day1Behav$Session = 1
day1Behav$Count = 1

#Load day 2 data
day2Behav <- read.table("Behaviour/CSL3D_Behav_Day2.csv",header = TRUE, sep=",")
#Remove eprme junk
day2Behav <- select(day2Behav, -c(Session,DataFile.Basename,AutoResponseWarning,Clock.Information,Display.RefreshRate,ExperimentVersion,RandomSeed,RuntimeCapabilities,RuntimeVersion,RuntimeVersionExpected,SessionDate,SessionStartDateTimeUtc,SessionTime,StudioVersion,TestMode,BlockAccC,BlockAccL,BlockRTC,BlockRTL,pos1,pos2,pos3,pos4,pos5,pos6,pos7,pos8,posColor,posShape,posSingDistr,posTarget,PracticeL,PracticeL.Cycle,PracticeL.Sample,CompSearch.OnsetToOnsetTime,LearnSearch.OnsetToOnsetTime,Response.OnsetToOnsetTime, Response2.OnsetToOnsetTime,LC4Blocks, LC4Blocks.Cycle, LC4Blocks.Sample)
)
#Add session information and a count variable
day2Behav$Session = 2
day2Behav$Count = 1

day3Behav <- read.table("Behaviour/CSL3D_Behav_Day3.csv",header = TRUE, sep=",")
#Remove eprme junk
day3Behav <- select(day3Behav, -c(Session,DataFile.Basename,AutoResponseWarning,Clock.Information,Display.RefreshRate,ExperimentVersion,RandomSeed,RuntimeCapabilities,RuntimeVersion,RuntimeVersionExpected,SessionDate,SessionStartDateTimeUtc,SessionTime,StudioVersion,TestMode,BlockAccC,BlockAccL,BlockRTC,BlockRTL,pos1,pos2,pos3,pos4,pos5,pos6,pos7,pos8,posColor,posShape,posSingDistr,posTarget, Task, Task.Cycle, Task.Sample)
)
#Add session information and a count variable
day3Behav$Session = 3
day3Behav$Count = 1

#Bind the 3 sessions together and remove old data
behavData <- rbind(day1Behav, day2Behav, day3Behav)
rm(day1Behav, day2Behav, day3Behav)

#Remove test data subjects
behavData <- filter(behavData, Subject != 99 & Subject != 999)

#Add group assignment information to data
groupData <- read.table("Behaviour/CSL3D_GroupInfo.csv",header = TRUE, sep=",")
for (Subj in c(1:36)) {
    behavData$Group[behavData$Subject==Subj] = groupData$Group[groupData$Subject==Subj]
}
behavData$Group = factor(behavData$Group, labels = c("Colour-Colour", "Colour-Shape", "Shape-Colour","Shape-Shape"))
#behavData$Group = factor(behavData$Group, levels = c("Colour-Colour", "Colour-Shape", "Shape-Shape", "Shape-Colour"))
```

```{r summaryTables, include=FALSE}
behavData %>% 
  group_by(Subject, Session) %>%
  summarise(numTrials = sum(Count)) %>%
  spread(Session, numTrials)

behavData %>%
  group_by(Subject, Group) %>%
  summarise(numTrials = sum(Count))
```

```{r behavStats}
cat.acc <- behavData %>%
  filter(Procedure == "TaskL", Session != 2) %>%
  mutate(Session = as.factor(Session)) %>%
  group_by(Group,Session,Subject) %>%
  summarise(Accuracy = mean(LearnSearch.ACC)*100)
cat.acc.aov <- aov_ez(data = cat.acc,
                            dv = "Accuracy",
                            id = "Subject",
                            within = c("Session"),
                            between = c("Group")
                            )
cat.rt <- behavData %>%
  filter(Procedure == "TaskL", Session != 2, LearnSearch.ACC==1) %>%
  mutate(Session = as.factor(Session)) %>%
  group_by(Group, Session,Subject) %>%
  summarise(ResponseTime = mean(LearnSearch.RT))
cat.rt.aov <- aov_ez(data = cat.rt,
                            dv = "ResponseTime",
                            id = "Subject",
                            within = c("Session"),
                            between = c("Group")
                            )

srch.acc <- behavData %>%
  filter(Procedure == "TaskC", Session != 2) %>%
  mutate(Session = as.factor(Session), CompCond = ifelse(LateralityComp=="TC" | LateralityComp=="TL","TO", "TD")) %>%
  group_by(Group, Session, CompCond,Subject) %>%
  summarise(Accuracy = mean(CompSearch.ACC))
srch.acc.aov <- aov_ez(data = srch.acc,
                            dv = "Accuracy",
                            id = "Subject",
                            within = c("Session","CompCond"),
                            between = c("Group")
                            )

srch.rt <- behavData %>%
  filter(Procedure == "TaskC", Session != 2, CompSearch.ACC==1) %>%
  mutate(Session = as.factor(Session), CompCond = ifelse(LateralityComp=="TC" | LateralityComp=="TL","TO", "TD")) %>%
  group_by(Group, Session, CompCond,Subject) %>%
  summarise(ResponseTime = mean(CompSearch.RT))
srch.rt.aov <- aov_ez(data = srch.rt,
                            dv = "ResponseTime",
                            id = "Subject",
                            within = c("Session","CompCond"),
                            between = c("Group")
                            )
srch.rt.emmeans <- emmeans(srch.rt.aov, ~Group*Session*CompCond)
srch.rt.posthoc <- pairs(srch.rt.emmeans)

distint <- behavData %>%
  filter(Procedure == "TaskC", Session != 2, CompSearch.ACC==1) %>%
  mutate(Session = as.factor(Session), CompCond = ifelse(LateralityComp=="TC" | LateralityComp=="TL","TO", "TD")) %>%
  group_by(Group, Session, CompCond, Subject) %>%
  summarise(ResponseTime = mean(CompSearch.RT)) %>%
  spread(CompCond, ResponseTime) %>%
  mutate(DistractorInterference = TD - TO)
distint.aov <- aov_ez(data = distint,
                            dv = "DistractorInterference",
                            id = "Subject",
                            within = c("Session"),
                            between = c("Group")
                            )
distint.emmeans <- emmeans(distint.aov, ~Group*Session)
distint.posthoc <- pairs(distint.emmeans)


save(cat.acc.aov, cat.rt.aov, srch.acc.aov, srch.rt.aov, distint.posthoc, file = "DataOutput/behavANOVAs.RData")
```

```{r behavPlots}
behavData %>%
  filter(Procedure == "TaskL", Session != 2) %>%
  mutate(Session = as.factor(Session)) %>%
  group_by(Group, Session,Subject) %>%
  summarise(Accuracy = mean(LearnSearch.ACC)) %>%
  mutate(se = sd(Accuracy)/sqrt(9))%>%
  group_by(Group,Session)%>%
  summarise(Accuracy = mean(Accuracy)*100, se = mean(se)*100) %>%
  ggplot(., aes(Session, Accuracy)) +
  geom_bar(stat = "identity") +
  facet_grid(.~Group) +
  geom_errorbar(aes(ymin = Accuracy-se, ymax = Accuracy+se), width = .2) +
  coord_cartesian(ylim=c(75,100))+
  theme_apa()
ggsave('Figures/Behav1.jpg',width=5, height=4, units="in", dpi = 300)

behavData %>%
  filter(Procedure == "TaskL", Session != 2, LearnSearch.ACC==1) %>%
  mutate(Session = as.factor(Session)) %>%
  group_by(Group, Session,Subject) %>%
  summarise(ResponseTime = mean(LearnSearch.RT)) %>%
  mutate(se = sd(ResponseTime)/sqrt(9))%>%
  group_by(Group,Session)%>%
  summarise(ResponseTime = mean(ResponseTime), se = mean(se)) %>%
  ggplot(., aes(Session, ResponseTime)) +
  geom_bar(stat = "identity") +
  facet_grid(.~Group) +
  geom_errorbar(aes(ymin = ResponseTime-se, ymax = ResponseTime+se), width = .2) +
  coord_cartesian(ylim=c(400,800))+
  theme_apa()
ggsave('Figures/Behav2.jpg',width=5, height=4, units="in", dpi = 300)

behavData %>%
  filter(Procedure == "TaskC", Session != 2) %>%
  mutate(Session = as.factor(Session), CompCond = ifelse(LateralityComp=="TC" | LateralityComp=="TL","TO", "TD")) %>%
  group_by(Group, Session, CompCond,Subject) %>%
  summarise(Accuracy = mean(CompSearch.ACC)) %>%
  mutate(se = sd(Accuracy)/sqrt(9))%>%
  group_by(Group,Session,CompCond)%>%
  summarise(Accuracy = mean(Accuracy)*100, se = mean(se)*100) %>%
  ggplot(., aes(x = Session, y = Accuracy, group = CompCond, fill=CompCond)) +
  geom_bar(position = "dodge", stat = "identity") +
  facet_grid(.~Group) +
  geom_errorbar(aes(ymin = Accuracy-se, ymax = Accuracy+se), width = .2, position=position_dodge(.9)) +
  coord_cartesian(ylim=c(75,100))+
  theme_apa()
ggsave('Figures/Behav3.jpg',width=5, height=4, units="in", dpi = 300)

behavData %>%
  filter(Procedure == "TaskC", Session != 2, CompSearch.ACC==1) %>%
  mutate(Session = as.factor(Session), CompCond = ifelse(LateralityComp=="TC" | LateralityComp=="TL","TO", "TD")) %>%
  group_by(Group, Session, CompCond,Subject) %>%
  summarise(ResponseTime = mean(CompSearch.RT)) %>%
  mutate(se = sd(ResponseTime)/sqrt(9))%>%
  group_by(Group,Session,CompCond)%>%
  summarise(ResponseTime = mean(ResponseTime), se = mean(se)) %>%
  ggplot(., aes(x = Session, y = ResponseTime, group = CompCond, fill=CompCond)) +
  geom_bar(position = "dodge", stat = "identity") +
  facet_grid(.~Group) +
  geom_errorbar(aes(ymin = ResponseTime-se, ymax = ResponseTime+se), width = .2, position = position_dodge(.9)) +
  scale_fill_manual(values=c("red4", "gray42"))+
  coord_cartesian(ylim=c(500,800))+
  theme_apa() +
  theme(#legend.position = "None",
        axis.line = element_line(colour = "black"))
ggsave('Figures/Behav4.jpg',width=5, height=4, units="in", dpi = 300)

behavData %>%
  filter(Procedure == "TaskC", Session != 2, CompSearch.ACC==1) %>%
  mutate(Session = as.factor(Session), CompCond = ifelse(LateralityComp=="TC" | LateralityComp=="TL","TO", "TD")) %>%
  group_by(Group, Session, CompCond, Subject) %>%
  summarise(ResponseTime = mean(CompSearch.RT)) %>%
  spread(CompCond, ResponseTime) %>%
  mutate(DistractorInterference = TD - TO) %>%
  mutate(se = sd(DistractorInterference)/9) %>%
  group_by(Group, Session) %>%
  summarise(DistractorInterference = mean(DistractorInterference), se = mean(se)) %>%
  ggplot(., aes(Session, DistractorInterference)) +
  geom_bar(stat = "identity", fill = "turquoise4") +
  facet_grid(.~Group) +
  geom_errorbar(aes(ymin = DistractorInterference-se, ymax = DistractorInterference+se), width = .2) +
  theme_apa() +
  theme(text= element_blank(),
          strip.text.y = element_blank(),
          strip.text.x = element_blank(),
          axis.title.x=element_blank(),
          axis.title.y=element_blank(),
          legend.position = "None")
```